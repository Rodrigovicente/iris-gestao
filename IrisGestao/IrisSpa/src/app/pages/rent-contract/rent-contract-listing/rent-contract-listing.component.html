<div class="header-background"></div>
<div class="content-wrapper">
	<div class="content">
		<header>
			<h3 class="text-2xl font-bold">
				Contratos
				<span class="ml-2 text-sm text-slate-600">{{
					totalContractCount
				}}</span>
			</h3>

			<div class="options">
				<span class="p-input-icon-left">
					<i class="pi pi-search"></i>
					<input
						pInputText
						class="w-44 white-theme"
						[(ngModel)]="filterText"
						(ngModelChange)="filterContractsDebounce($event)"
						type="text"
						placeholder="Buscar contrato"
					/>
				</span>

				<p-dropdown
					class=""
					styleClass="w-[10.8rem] white-theme small"
					placeholder="Base de reajuste"
					[options]="basesReajuste"
					[(ngModel)]="filterBase"
					(ngModelChange)="filterContractsDebounce($event)"
				></p-dropdown>

				<p-dropdown
					class=""
					styleClass="w-44 white-theme small"
					placeholder="Tipo de contrato"
					[options]="tiposImovel"
					aria-describedby="contract-type-help"
					[(ngModel)]="filterType"
					(ngModelChange)="filterContractsDebounce($event)"
				></p-dropdown>

				<p-calendar
					dateFormat="dd/mm/yy"
					class=""
					styleClass="w-32"
					(onInput)="onInputDate($event)"
					(onBlur)="onBlurDate()"
					placeholder="Data de início"
					panelStyleClass="hidden"
					[(ngModel)]="filterStart"
					(ngModelChange)="filterContractsDebounce($event)"
				></p-calendar>

				<p-calendar
					dateFormat="dd/mm/yy"
					class=""
					styleClass="w-32"
					(onInput)="onInputDate($event)"
					(onBlur)="onBlurDate()"
					placeholder="Data de fim"
					panelStyleClass="hidden"
					[(ngModel)]="filterEnd"
					(ngModelChange)="filterContractsDebounce($event)"
				></p-calendar>

				<!-- <p-dropdown
					class="mx-2"
					styleClass="w-36 white-theme"
					placeholder="Vencimento"
					[options]="vencimentos"
					[(ngModel)]="filterDue"
					(ngModelChange)="filterContractsDebounce($event)"
				></p-dropdown> -->

				<button
					pButton
					type="button"
					class="p-button-outlined h-9 white-theme"
					(click)="navigateTo('rent-contract/register')"
				>
					<i class="pi pi-plus"></i>
					Novo Contrato
				</button>
			</div>
		</header>
		<ng-container>
			<ng-container *ngIf="isLoadingContracts">
				<app-spinner styleClass="mt-11"></app-spinner>
			</ng-container>
			<ng-container *ngIf="!isLoadingContracts && noRestults">
				<div class="no-results-warn">
					<span>Nenhum resultado</span>
				</div>
			</ng-container>

			<p-table
				[value]="contractEntries"
				styleClass="p-datatable-striped"
				[tableStyle]="{ 'min-width': '50rem' }"
				[paginator]="!noRestults && !isLoadingContracts"
				[rows]="rows"
				[(first)]="first"
				responsiveLayout="scroll"
				[totalRecords]="totalContractCount"
				[lazy]="true"
				(onLazyLoad)="loadContractsPage($event)"
			>
				<ng-template pTemplate="header">
					<tr *ngIf="!isLoadingContracts && !noRestults">
						<th>Nome do locatário</th>
						<!-- <th>Unidade locada</th> -->
						<th>Início do contrato</th>
						<th>Próximo reajuste</th>
						<th>Vencimento do contrato</th>
						<th>Base de reajuste</th>
						<th></th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-contract>
					<tr>
						<!-- \/ ?? -->
						<td class="font-bold">{{ contract.locatario }}</td>
						<!-- \/ ?? multiplos imoveis com multiplas unidades-->
						<!-- <td>{{ contract.unidade }}</td> -->
						<td>{{ contract.dataInicioContrato | date : "shortDate" }}</td>
						<!-- \/ ?? -->
						<td>{{ contract.proxAjuste }}</td>
						<td>{{ contract.dataFimContrato | date : "shortDate" }}</td>
						<!-- \/ ?? -->
						<td>{{ contract.baseReajuste }}</td>
						<td class="action w-40">
							<!-- <button
								type="button"
								pButton
								icon="pi pi-ellipsis-v"
								class="p-button-rounded"
								(click)="
									actionMenu.toggle($event); setCurrentContract(contract)
								"
							></button> -->

							<button
								pButton
								type="button"
								class="p-button-text h-7"
								(click)="
									navigateTo('rent-contract/details/' + contract.guidReferencia)
								"
							>
								Ver detalhes
							</button>
						</td>
					</tr>
				</ng-template>
			</p-table>
		</ng-container>
	</div>
</div>

<p-menu #actionMenu [popup]="true" [model]="tableMenu"></p-menu>
